<html>
    <head>
        <style>
            @font-face {
                font-family: "Inter";
                src: url(res/Inter.ttf);
            }
            @keyframes shake {
            10%, 90% {
                transform: translate3d(-1px, 0, 0);
            }
            
            20%, 80% {
                transform: translate3d(2px, 0, 0);
            }

            30%, 50%, 70% {
                transform: translate3d(-4px, 0, 0);
            }

            40%, 60% {
                transform: translate3d(4px, 0, 0);
            }
            }


            
            ::selection {
                background:  rgba(255, 161, 161, 0.7); /* WebKit/Blink Browsers */
            }

            body {
                background: #333333;
                margin: 0;
                color: white;
                font-family: "Inter", sans-serif;
                user-select: none;
            }

            .testermode {
                filter: hue-rotate(-110deg);
                background: linear-gradient(27deg, rgba(56,48,12,1) 0%, rgba(26,24,48,1) 50%, rgba(0,55,55,1) 100%);
            }

            input[type=text] {
                padding: 15px;
                background-color: rgb(32, 32, 32);
                border: 2px solid rgb(70, 70, 70);
                border-radius: 7px;
                color: white;
                font-size: 14pt;
                transition: ease .2s;
                width: calc(50% - 32px);
                margin: 20px 19px;
                font-family: "Inter", sans-serif;
                height: 56px;
            }
            button {
                padding: 15px;
                background-color: rgb(32, 32, 32);
                border: 2px solid rgb(70, 70, 70);
                font-size: 14pt;
                border-radius: 7px;
                color: white;
                margin: 5px;
                transition: ease .2s;
                cursor: pointer;
                height: 56px;
                font-family: "Inter", sans-serif;
            }
            
            button:focus, input:focus {
                box-shadow: 0 0 5px #FF848467;
                border-color: #a16e6e;
            }
            button:hover, input:hover {
                box-shadow: 0 0 10px #FF8484a2;
                border-color: #ffabab;
            }
            *:focus {
                outline: none;
            }
            #dlmods {
                background: url('res/icons/get_app-white-18dp.svg') no-repeat rgb(32, 32, 32) 9px 10px;
                background-size: 30px;
                padding-left: 45px;
            }
            #rmmods {
                background: url('res/icons/delete_sweep-white-18dp.svg') no-repeat rgb(32, 32, 32) 9px 10px;
                background-size: 30px;
                padding-left: 45px;
            }
            #launch {
                background: url('res/icons/play_circle-white-18dp.svg') no-repeat rgb(32, 32, 32) 9px 10px;
                background-size: 30px;
                padding-left: 45px;
                width: calc(50% - 32px);
                margin: 20px 20px 20px 0;
                margin-left: auto;
            }
            #progress {
                height: 20px;
                background-color: rgb(32, 32, 32);
                width: 100%;
            }
            #pbar {
                position: relative;
                background-color: #FF8484;
                width: 0%;
                height: 20px;
                transition: ease .2s;
            }
            #top {
                height: calc(100vh - 167px);
                text-align: center;
                padding-top: 50px;
                overflow-y: auto;
            }
            #bottom {
                height: 116px;
                background-color: rgba(0, 0, 0, 0.7);
                
            }
            #console {
                margin: 15px 0;
                height: 200px;
                width: 100%;
                background-color: rgb(32, 32, 32);
                text-align: start;
                overflow-y: auto;
                font-family: monospace;
                user-select: text;
            }
            #console .entry {
                padding: 2px 5px;
                word-wrap: break-word
                
            }
            .logo {
                width: 70%;
                max-height: 80px;
                margin-bottom: 40px;
                -webkit-user-drag: none;
            }




            #console::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            #console::-webkit-scrollbar-track {
                border-radius: 10px;
                background: rgba(0,0,0,0.1);
            }
            #console::-webkit-scrollbar-thumb{
                border-radius: 10px;
                background: rgba(0,0,0,0.2);
            }
            #console::-webkit-scrollbar-thumb:hover{
                background: rgba(0,0,0,0.4);
            }
            #console::-webkit-scrollbar-thumb:active{
                background: rgba(0,0,0,.9);
            }
            



            #top::-webkit-scrollbar {
                width: 6px;
                height: 6px;
            }
            #top::-webkit-scrollbar-track {
                border-radius: 10px;
                background: rgba(0,0,0,0.1);
            }
            #top::-webkit-scrollbar-thumb{
                border-radius: 10px;
                background: rgba(0,0,0,0.2);
            }
            #top::-webkit-scrollbar-thumb:hover{
                background: rgba(0,0,0,0.4);
            }
            #top::-webkit-scrollbar-thumb:active{
                background: rgba(0,0,0,.9);
            }




            #launch.loading-spinner, #dlmods.loading-spinner {
                background: url('res/icons/Rolling-1s-18px.svg') no-repeat rgb(32, 32, 32) 9px 10px;
                background-size: 30px;
                padding-left: 45px;
            }

            p {
                margin: 0;
                font-size: 80%;
                color: rgb(134, 134, 134);
            }


            .dis {
                color: rgb(158, 158, 158);
                filter: contrast(50%);
            }
            
            .dis:focus {
                box-shadow: 0 0 10px rgba(158, 158, 158, 0.2);
                border-color: rgb(153, 153, 153);
            }
            .dis:hover {
                box-shadow: 0 0 10px rgba(158, 158, 158, 0.8);
                border-color: rgb(255, 255, 255);
            }
            .disclick {
                animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both;
                transform: translate3d(0, 0, 0);
            }
            .green {
                color: rgb(68, 139, 68);
            }
            input[type="checkbox"] {
                position: relative;
                -webkit-appearance: none;
                background-color: rgb(32, 32, 32);
                padding: .5rem;
                transition: all .1s ease;
                margin: .25rem;
                border: transparent .15rem solid;
                outline: none;
                box-shadow: none;
                border-radius: 5px;
                top: 9px;
            }

            input[type="checkbox"]:checked {
                background-color: #FF8484;
            }

            input[type="checkbox"]:focus {
                border-color: #c36b6b;
            }

            input[type="checkbox"]:not(.switch):before {
                content: '';
                position: absolute;
                width: .15rem;
                height: 0rem;
                left: .4rem;
                top: 0rem;
                border: rgb(93, 93, 93) .15rem solid;
                border-left: none;
                border-top: none;
                transform: rotate(45deg);
                transition: all .1s ease;
                opacity: 0;
            }

            input[type="checkbox"]:not(.switch):checked::before {
                height: .4rem;
                top: .15rem;
                opacity: 1;
            }

            input[type="checkbox"].switch {
                width: 2.5rem;
                border-radius: 100px;
            }
            .check {
                margin: 0 0 20px 0;
                font-size: 90%;
            }

            details {
                margin: 2.3rem 0;
                padding: 0;
                max-height: 23px;
                transition: ease 0.2s;
                overflow: hidden;
            }
            details[open] {
                max-height: 230px;
                transition: ease 0.2s;
            }

            details summary {
                font-weight: bold;
                cursor: pointer;
                display: block;
                position: relative;
                text-align: start;
                margin: 0 auto;
                width: fit-content;
                left: 10px;
            }

            details summary::-webkit-details-marker {
                display: none;
            }

            details summary::marker {
                display: none;
            }

            details summary::before {
                content: '';
                border-width: .4rem;
                border-style: solid;
                border-color: transparent transparent transparent #fff;
                position: absolute;
                top: .3rem;
                left: -1.25rem;
                transform: rotate(0);
                transform-origin: .2rem 50%;
                transition: .25s transform ease;
            }

            details[open]>summary:before {
                transform: rotate(90deg);
            }
        </style>
        <script>
            const { ipcRenderer } = require('electron')
            
            ipcRenderer.on('takeappversion', (e, v) => {document.getElementById('versionstr').innerText = v})

            function shake(id) {
                document.getElementById(id).classList.remove('disclick');
                document.getElementById(id).classList.add('disclick');
                setTimeout(() => document.getElementById(id).classList.remove('disclick'), 300)
            }

            ipcRenderer.on('log', (e, data) => {
                console.log(data)
                let a = document.createElement("div")
                a.className = 'entry'
                a.innerText = data
                document.getElementById('console').appendChild(a)
                document.getElementById('console').scrollTop = document.getElementById('console').scrollHeight
                
            })
            ipcRenderer.on('pbar', (e, progress) => {
                document.getElementById('pbar').style.width = `${Math.round(progress*100)}%`
            })
            ipcRenderer.on('mpload', (e, isloading) => {
                if (isloading) {
                    document.getElementById("dlmods").classList.add('loading-spinner')
                    document.getElementById('dlmods').innerText = 'Скачивание...'
                } else {
                    document.getElementById("dlmods").classList.remove('loading-spinner')
                    document.getElementById('dlmods').innerText = 'Скачать модпак'
                }
            })
            ipcRenderer.on('mprem', (e, isloading) => {
                if (isloading) {
                    document.getElementById("rmmods").classList.add('loading-spinner')
                    document.getElementById('rmmods').innerText = 'Удаление...'
                } else {
                    document.getElementById("rmmods").classList.remove('loading-spinner')
                    document.getElementById('rmmods').innerText = 'Удалить модпак'
                }
            })
            ipcRenderer.on('gameload', (e, isloading) => {
                if (isloading) {
                    document.getElementById("launch").classList.add('loading-spinner')
                    document.getElementById('launch').innerText = 'Запуск...'
                    document.getElementById("launch").classList.add('dis')
                    document.getElementById("rmmods").classList.add('dis')
                    document.getElementById("dlmods").classList.add('dis')
                } else {
                    document.getElementById('pbar').style.width = '0'
                    document.getElementById("launch").classList.remove('loading-spinner')
                    document.getElementById('launch').innerText = 'Запустить'
                    document.getElementById("launch").classList.remove('dis')
                    document.getElementById("rmmods").classList.remove('dis')
                    document.getElementById("dlmods").classList.remove('dis')
                }
            })

            ipcRenderer.on('mpstatus', (e, installed) => {
                if (installed) {
                    document.getElementById("launch").classList.remove('dis')
                    document.getElementById("rmmods").classList.remove('dis')
                    document.getElementById("dlmods").classList.add('dis')
                } else {
                    document.getElementById("launch").classList.add('dis')
                    document.getElementById("rmmods").classList.add('dis')
                    document.getElementById("dlmods").classList.remove('dis')
                }
            })

            ipcRenderer.on('prefs', (e, prefs) => {
                document.getElementById('nickname').value = prefs.nickname
                document.getElementById('rampick').value = prefs.ram
                document.getElementById('connect').checked = prefs.connect

                document.getElementById('nickname').addEventListener('keypress', (e) => {
                    let match = (e.target.value + e.key).match(/^\w{0,16}$/)
                    if (!match || match[0] == "") {
                        e.preventDefault()
                        e.stopPropagation()
                    }
                })
            })

            function dlmp(o) {
                if (o.classList.contains('dis')) return shake('dlmods');
                ipcRenderer.send('dl-modpack')
            }
            function rmmp(o) {
                if (o.classList.contains('dis')) return shake('rmmods');
                ipcRenderer.send('rm-modpack')
            }
            function play() {
                if (document.getElementById('nickname').value == 'TESTER MODE') {
                    document.getElementById('nickname').value = ''
                    document.body.classList.add('testermode')
                    ipcRenderer.send('tester-mode')
                    return
                }
                ipcRenderer.send('save-fields', document.getElementById('nickname').value, document.getElementById('rampick').value, document.getElementById('connect').checked)
                if (document.getElementById('launch').classList.contains('dis')) return shake('launch');
                if (!document.getElementById('nickname').value.match(/^\w{3,16}$/i)) return alert('Введен некорректный никнейм.\nВы можете использовать английские буквы, цифры и нижние подчеркивания, длиной от 3 до 16 символов.');
                ipcRenderer.send('launch', document.getElementById('nickname').value, document.getElementById('rampick').value, document.getElementById('connect').checked)
            }

            document.addEventListener('keypress', (e) => {
                if (e.code === "Enter" && (document.activeElement.id != 'dlmods') && (document.activeElement.id != 'rmmods')) {
                    play()
                } else if (e.code === "F1") {
                    
                }
            })

            
        </script>
    </head>
    <body>
        <div id="top">
            <img src="res/ntl.svg" class="logo">
            <p id="versionstr"></p>
            <br>
            <button id="dlmods" onclick="dlmp(this)">Скачать модпак</button>
            <button id="rmmods" onclick="rmmp(this)">Удалить модпак</button>
            <details>
                <summary>Консоль</summary>
                <div id="console">
                    <div class="entry" ondblclick="ipcRenderer.send('upload-log')">[LOG START]</div>
                </div>
            </details>
            
            <h3>Выделение памяти</h3>
            <p>Мин. (ниже возможны проблемы): <b>3600M</b><br><span class="green">Рек.: <b>4G</b></span><br>Ульт.: <b>5G</b></p>
            <input type="text" id="rampick" placeholder="4G">
            <p class="check"><input id="connect" type="checkbox"><label for="connect"> Подключаться к серверу автоматически после запуска игры</label></p>
        </div>
                
        <div id="bottom">
            <input type="text" id="nickname" placeholder="Никнейм">
            <button id="launch" onclick="play()">Запустить</button>
            <div id="progress"><div id="pbar"></div></div>
        </div>
        <script>
            ipcRenderer.send('load-finish')
        </script>
    </body>
</html>